# Описание подсистемы

Даная подсистема создана для Интеграции 1с ERP c системой WMS 3000 (реализация у компании Поставщик)



## Обработки

### Новая обработка ИРВ_ТранспортОбменаFTPcwms3000

Реализует функционал работы с FTP для выгрузки/загрузки файлов.
В макете Поставщик хранит настройки шаблонов имен файлов и путей хранения.

Внешний Интерфейс:
```bsl
    Функция Инициализация(ИмяМакета = "Поставщик") Экспорт
    Функция ОтправитьСообщение(ИмяСхемы, ВременноеИмяФайла, ДопПараметры, ОчиститьЛогирование = Истина) Экспорт
    Функция ПолучитьТаблицуФалов(ИменаСхем, ДопПараметры, ПроверкаНаличия = Ложь) Экспорт
    Функция СтруктураДопПараметры(УДОбъекта = "", ТипОперации = "", НомерСообщения = "") Экспорт
    Функция УдалитьФайлыПослеОбработки(ТаблицаФайловСообщенийОбмена, ОчиститьЛогирование = Истина) Экспорт
```

### Новая обработка ИРВ_ИнтеграцияWMS3000

    Создана для выгрузки/загрузки файлов с использованием как прокси - обработки ИРВ_ТранспортОбменаFTPcwms3000.
Вся бизнес-логика реализованна в модуле обработки. 
Для начала работы с обработкой требуется создание, и вызова функции Инициализация.
Дальше по бизнес процессу для выгрузки всех требуемых данных вызываем функцию ВыполнитьОбмен - выгружает номенклатуру, контрагентов которые есть в документе, после паузы в 15 сек выгружает сам документ.


Внешний Интерфейс:
```bsl
    Функция Инициализация(ОчиститьЛогирование) Экспорт
    Функция СтрокаЛогОшибок() Экспорт
    Функция ВыполнитьОбмен(МассивДанных, ОчиститьЛогирование, ДопПараметры = Неопределено) Экспорт
    Функция ОтправитьФайлСообщения(ИмяСхемы, ВременноеИмяФайла, ДопПараметры) Экспорт
    Функция ВыгрузитьСпрНоменклатура(ТаблицаДанных, ОчиститьЛогирование, ДопПараметры = Неопределено) Экспорт
    Функция ВыгрузитьСпрКонтрагентов(МассивДанных, ОчиститьЛогирование, ДопПараметры = Неопределено) Экспорт
    Функция ВыгрузитьДокПриходныйОрдер(МассивДанных, ОчиститьЛогирование, ДопПараметры = Неопределено) Экспорт
    Функция ВыгрузитьДокРасходныйОрдер(МассивДанных, ОчиститьЛогирование, ДопПараметры = Неопределено) Экспорт
    Функция ЗагрузитьОповещения(ОчиститьЛогирование, ДопПараметры = Неопределено)  Экспорт
    Функция ЗагрузитьИзФайла(ВходящиеДанные, ОчиститьЛогирование, ДопПараметры = Неопределено) Экспорт
```

Содержит форму для программиста/аналитика для ручной работы и тестирования функционала



### Новая ИРВ_ТрансформацияУпаковокМДЛП


Содержит форму для пользователя.



## Подсистема

### Новая ИРВ_ИнтеграцияWms3000

Создана для удобной разработки интеграции. Владелец подсистемы - подсистема ИРВ_ИРВИН2.
Подсистема отображается в командном интерфейсе.

Содержит все добавленные объекты метаданных и элементы с которыми взаимодействует интеграция.
В корне все отображаемые сущности, в подчиненном элементе "НеПоказывать" - все элементы к которыми взаимодействуем.

###  Новая ИРВ_ИнтеграцияWms3000.НеПоказывать

Созданная подсистема НеПоказывать - для группировки участвующих объектов метаданных, которые не требуется отображать в командном интерфейсе

## Общие модули

### Новый модуль ИРВ_ОбщиеWMS3000Сервер 

    Для вынесение повторяемых функций при использовании интеграции
    
Добавлены новые экспортные:
```bsl
    Функция АдаптироватьСтроку(ВхДанные, Знач МакДлинна = 0) Экспорт
    Функция ОбъединенноеЗначениеВСтроку(Знач ВхДанныеПервый, Знач ВхДанныеВторой = Неопределено, Знач МакДлинна = 0) Экспорт
    Функция КонвертацияСтроки(ВходящаяСтрока, МакДлинна = 0) Экспорт
    Функция КонвертацияЧисло(ВходящаяЧисло) Экспорт
```

### Новый модуль Расш_ИРВ_ТрансформацияУпаковокМДЛП (автор Румянцев Владимир)

Добавлены новые экспортные:
```bsl
    Функция ИРВ_ПолучитДанныеДляФормированияДокументовТрансформации() Экспорт
    Функция ИРВ_ПроверкаУпаковокПоДокументу(Документ) Экспорт
    Функция ИРВ_СформироватьДокументыАгрегированииИТрансформации(ДанныеФормирования) Экспорт
    Функция ИРВ_СформироватьУведомлениеОбОтгрузкеМДЛП(ДокументыОснованияОтгрузки, ДанныеДляИзменения) Экспорт  
```

###  Расш_ИРВ_ОбменСоСкладом

    Проверки заполнений документов

Добавлены новые:
```bsl
    Функция ЗаполнитьТипТовараВДокументе(ТекДокументОбъект, ТабличнаяЧастьТоваров) Экспорт
```

Заполнение реквизита ИВР_ТипТовараВДокументе в документах Расходный и Приходный ордера на товар.
вызывается ПередЗаписью и ОбработкаЗаполнения 

## Роли

### Новая роль ИРВ_ПравоИзмененияСправочникиWms3000

### Новая роль ИРВ_ПравоЧтениеСправочникиWms3000


## План обменов 
 
### Новый план обменов ИРВ_ОбменWMS3000

    Нужен для дальнешего развития автоматизации интеграции/
В состав включены несколько метаданных, авторегистрация отключена. 
В будущем можно разработать несколько подписок на события изменений для регистрации в план обмена и последующей выгрузкой.

Состав: 
    * Контрагенты
    * Номенклатура
    * ХарактеристикиНоменклатуры 

## Схемы XDTO

### Новая Схема wms3000_Reference

Схема используется для выгрузки Контрагентов 
URL пространство http://www.cwms3000.ru/xsd/Reference
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp

### Новая Схема wms3000_Nomenklatura

Схема используется для выгрузки Номенклатуры
URL пространство http://www.cwms3000.ru/xsd/Nomenklatura
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp

### Новая Схема wms3000_InDoc

Схема используется для выгрузки документа Приходный Ордер на товар
URL пространство http://www.cwms3000.ru/xsd/Indoc
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp


### Новая Схема wms3000_InDocFlashback

    Схема используется для Загрузки ответа в документ Приходный Ордер на товар
URL пространство http://www.cwms3000.ru/xsd/Indocflashback
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp
Добавлен тип NonEmptyStringType, изменен тип свойства Batch - потребовалось для решение ситуации когда в серии есть запрещенные символы по схеме (например точка, пробел).


### Новая Схема wms3000_OutDoc

    Схема используется для выгрузки документа Расходного Ордер на товар
URL пространство http://www.cwms3000.ru/xsd/Outdoc
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp
Переименованное свойство Date в Date_1c, для корректной работы 1с со схемой где два свойства с одним названием
Перед выгрузкой в файл текст заменяем обратно.


### Новая Схема wms3000_OutDocFlashback

    Схема используется для Загрузки ответа в документ Расходного Ордер на товар
URL пространство http://www.cwms3000.ru/xsd/Outdocflashback
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp
Добавлен тип NonEmptyStringType, изменен тип свойства Batch - потребовалось для решение ситуации когда в серии есть запрещенные символы по схеме (например точка, пробел).


### Новая Схема wms3000_TransformationFlashback

    Схема используется для получения информации о разных трансформациях по товару в рамках МДЛП
URL пространство http://www.cwms3000.ru/xsd/Transformationflashback
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp
Файлы ни как не обрабатываются, прикрепляются к документу.


### Новая Схема wms3000_Error

    Схема используется для получения информации по ошибкам на HAB
URL пространство http://www.cwms3000.ru/xsd/Error
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp


### Новая Схема wms3000_Response

    Схема используется для загрузки ответа об успешной записи данных в базу WMS
URL пространство http://www.cwms3000.ru/xsd/Response
Модифицированное в пространства имен, было http://www.cwms3000.ru/xsd/ncp

## Справочники

### Новые ИРВ_СоответствиеТемпературныйРежимWms3000

Создан для заполнения соответствия нашего перечисления ИРВ_ТемпературыХраненияТовара и данных схемы WMS 3000 для номенклатуры.
Варианты значений взяты из схемы обменов, хранятся в справочнике ИВР_ТемпературныйРежимWms3000

В списке справочника в командной панели ЕЩЕ есть команда ЗаполнитьПоУмолчанию, которая создает элементы в справочнике, на основании нашего перечисления ИРВ_ТемпературыХраненияТовара. После заполнения требуется руками обогатить информацию. 

### Новые ИВР_ТемпературныйРежимWms3000

Заполняется данными из схемы по Номенклатуре Schemas\Mark_adaptation\[Schema] Nomenklatura.xsd
В списке справочника в командной панели ЕЩЕ есть команда ЗаполнитьПоУмолчанию, которая создает элементы в справочнике, без проверки на дубли.

### ИРВ_ПредопределенныеЭлементы

Добавлены Предопределенные Элементы:
    ОбменСоСкладомWms3000 - папка
    ПараметрыFTPДляОбменовСоСкладом - указывает на рабочею  настройку подключения к FTP
    ПараметрыFTPДляОбменовСоСкладомТест - указывает на тестовую настройку подключения к FTP
    ПутьWinSCP - для дальнейшего развития интеграции.

## Документы

### документ ПриходныйОрдерНаТовары

Добавлены реквизиты 
    ИВР_УровеньПриемки
    ИВР_ТипТовараВДокументе - тип ПеречислениеСсылка.ИВР_ТипыТовараВДокументе

### Документ РасходныйОрдерНаТовары

Добавлены реквизиты
    ИВР_ТипТовараВДокументе - тип ПеречислениеСсылка.ИВР_ТипыТовараВДокументе


### Документ ИРВ_СкладскаяОперацияМДЛП_Приход

Добавлены реквизиты табличная часть ТоварыWMS
    * СостояниеТовара - тип ПеречислениеСсылка.ГрадацииКачества
    * ПодтипСостояния - тип ПеречислениеСсылка.ИРВ_ПодтипыСостоянияТовара


### Документ ИРВ_СкладскаяОперацияМДЛП_Расход

Добавлены реквизиты табличная часть ТоварыWMS
    * СостояниеТовара - тип ПеречислениеСсылка.ГрадацииКачества
    * ПодтипСостояния - тип ПеречислениеСсылка.ИРВ_ПодтипыСостоянияТовара
    * КоличествоКондиция - тип Число, целое 12 символов
    * КоличествоБрак - тип Число, целое 12 символов

## Перечисления

### Новый ИВР_УровниПриемки

Значения
    НеУказано
    Паллет
    Короб
    ВторичнаяУпаковка

### Новый ИРВ_ПодтипыСостоянияТовара

Значения
    НеУказано
    БракПоСрокуГодности
    БракИзЗаМехПовреждОбнаруженныйПриПриемке
    БракПоНедовложениюОбнаруженныйПриПриемке
    БракПоНедовложениюНаСкладе
    БракИзЗаМехПоврежденийПриХраненииНаСкладе
    ПроизводственныйБрак
    ПроизводственныйБракПоНедовложению
    Кондиция
    ЗначениеПеречисления2
    ЗначениеПеречисления3
    ЗначениеПеречисления4
    БракПоНарушениюТемпературногоРежима

### Новый ИВР_ТипыТовараВДокументе

Значения
    Немаркированный
    Маркированный


## Регистр Сведений 

### Новый ИРВ_ИдентификаторыСинхронизируемыхОбъектов

Измерения 
    УзелИнформационнойБазы - тип ПланОбменаСсылка
    Идентификатор - тип Строка 120
    СсылкаОсновная - тип СправочникСсылка
    СсылкаВторичная - тип СправочникСсылка
    ТипПриемника - тип Строка 100

Ресурсов, реквизитов - нету.

Модуль менеджера Добавлены новые:
```bsl
    Функция ДобавитьЗапись(СтруктураЗаписи, Загрузка = Ложь) Экспорт
    Функция УдалитьЗапись(СтруктураЗаписи, Загрузка = Ложь) Экспорт
    Функция ПубличныйИдентификаторПоСсылкеОбъекта(СсылкаОсновная, СсылкаВторичная, ДопПараметры) Экспорт
    Функция ПубличныйОбъектаПоИдентификатору(Идентификатор, ВернутьСтруктуру = Ложь, ДопПараметры) Экспорт
```